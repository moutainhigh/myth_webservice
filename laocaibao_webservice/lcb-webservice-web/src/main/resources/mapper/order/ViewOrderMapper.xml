<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zdmoney.mapper.order.ViewOrderMapper" >
  <resultMap id="BaseResultMap" type="com.zdmoney.models.order.ViewOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="ORDER_NUM" property="orderNum" jdbcType="VARCHAR" />
    <result column="CUSTOMER_ID" property="customerId" jdbcType="DECIMAL" />
    <result column="ORDER_AMT" property="orderAmt" jdbcType="DECIMAL" />
    <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL" />
    <result column="ORDER_TIME" property="orderTime" jdbcType="DATE" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="YEAR_RATE" property="yearRate" jdbcType="DECIMAL" />
    <result column="INTEREST_START_DATE" property="interestStartDate" jdbcType="DATE" />
    <result column="INTEREST_END_DATE" property="interestEndDate" jdbcType="DATE" />
    <result column="PRINCIPALINTEREST" property="principalinterest" jdbcType="DECIMAL" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="INVITE_CODE" property="inviteCode" jdbcType="VARCHAR" />
    <result column="CONFIRM_PAYMENT_DATE" property="confirmPaymentDate" jdbcType="DATE" />
    <result column="PAY_SER_NUM" property="paySerNum" jdbcType="VARCHAR" />
    <result column="BANK_ACCOUNT_ID" property="bankAccountId" jdbcType="DECIMAL" />
    <result column="CM_OPEN_MECHANISM" property="cmOpenMechanism" jdbcType="VARCHAR" />
    <result column="CM_OPEN_PLATFORM" property="cmOpenPlatform" jdbcType="VARCHAR" />
    <result column="CM_TOGATHER_TYPE" property="cmTogatherType" jdbcType="VARCHAR" />
    <result column="CM_OPEN_CHANNEL" property="cmOpenChannel" jdbcType="VARCHAR" />
    <result column="CM_REGISTER_VERSION" property="cmRegisterVersion" jdbcType="VARCHAR" />
    <result column="IS_FIRST_ORDER" property="isFirstOrder" jdbcType="DECIMAL" />
    <result column="ORIGINAL_RATE" property="originalRate" jdbcType="DECIMAL" />
    <result column="INVTE_RATE" property="invteRate" jdbcType="DECIMAL" />
    <result column="ACTION_RATE" property="actionRate" jdbcType="DECIMAL" />
    <result column="YEAR_RATE_STR" property="yearRateStr" jdbcType="VARCHAR" />
    <result column="DAY_PROFIT" property="dayProfit" jdbcType="DECIMAL" />
    <result column="RAISE_DAY_PROFIT" property="raiseDayProfit" jdbcType="DECIMAL" />
    <result column="RAISE_DAYS" property="raiseDays" jdbcType="DECIMAL" />
    <result column="CLOSE_DAYS" property="closeDays" jdbcType="DECIMAL" />
    <result column="PRODUCT_TYPE" property="productType" jdbcType="VARCHAR" />
    <result column="SUBJECT_STATUS" property="subjectStatus" jdbcType="VARCHAR" />
    <result column="PAY_TYPE" property="payType" jdbcType="VARCHAR" />
    <result column="TRANSFER_TYPE" property="transferType" jdbcType="VARCHAR" />
    <result column="MODIFY_DATE" property="modifyDate" jdbcType="DATE" />
    <result column="RAISE_RATE_INCOME" property="raiseRateIncome" jdbcType="DECIMAL" />
    <result column="COUPON_AMOUNT" property="couponAmount" jdbcType="DECIMAL" />
    <result column="INTEGRAL_AMOUNT" property="integralAmount" jdbcType="DECIMAL" />
    <result column="CASH_AMOUNT" property="cashAmount" jdbcType="DECIMAL" />
    <result column="DEBTOR_NUM" property="debtorNum" jdbcType="VARCHAR" />
    <result column="DEBTOR_NAME" property="debtorName" jdbcType="VARCHAR" />
  </resultMap>
  <insert id="insert" parameterType="com.zdmoney.models.order.ViewOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into LAOCAIBAO.VIEW_ORDER (ID, ORDER_NUM, CUSTOMER_ID, 
      ORDER_AMT, PRODUCT_ID, ORDER_TIME, 
      STATUS, YEAR_RATE, INTEREST_START_DATE, 
      INTEREST_END_DATE, PRINCIPALINTEREST, CUSTOMER_NAME, 
      INVITE_CODE, CONFIRM_PAYMENT_DATE, PAY_SER_NUM, 
      BANK_ACCOUNT_ID, CM_OPEN_MECHANISM, CM_OPEN_PLATFORM, 
      CM_TOGATHER_TYPE, CM_OPEN_CHANNEL, CM_REGISTER_VERSION, 
      IS_FIRST_ORDER, ORIGINAL_RATE, INVTE_RATE, 
      ACTION_RATE, YEAR_RATE_STR, DAY_PROFIT, 
      RAISE_DAY_PROFIT, RAISE_DAYS, CLOSE_DAYS, 
      PRODUCT_TYPE, SUBJECT_STATUS, PAY_TYPE, 
      TRANSFER_TYPE, MODIFY_DATE, RAISE_RATE_INCOME, 
      COUPON_AMOUNT, INTEGRAL_AMOUNT, CASH_AMOUNT, 
      DEBTOR_NUM, DEBTOR_NAME)
    values (#{id,jdbcType=DECIMAL}, #{orderNum,jdbcType=VARCHAR}, #{customerId,jdbcType=DECIMAL}, 
      #{orderAmt,jdbcType=DECIMAL}, #{productId,jdbcType=DECIMAL}, #{orderTime,jdbcType=DATE}, 
      #{status,jdbcType=VARCHAR}, #{yearRate,jdbcType=DECIMAL}, #{interestStartDate,jdbcType=DATE}, 
      #{interestEndDate,jdbcType=DATE}, #{principalinterest,jdbcType=DECIMAL}, #{customerName,jdbcType=VARCHAR}, 
      #{inviteCode,jdbcType=VARCHAR}, #{confirmPaymentDate,jdbcType=DATE}, #{paySerNum,jdbcType=VARCHAR}, 
      #{bankAccountId,jdbcType=DECIMAL}, #{cmOpenMechanism,jdbcType=VARCHAR}, #{cmOpenPlatform,jdbcType=VARCHAR}, 
      #{cmTogatherType,jdbcType=VARCHAR}, #{cmOpenChannel,jdbcType=VARCHAR}, #{cmRegisterVersion,jdbcType=VARCHAR}, 
      #{isFirstOrder,jdbcType=DECIMAL}, #{originalRate,jdbcType=DECIMAL}, #{invteRate,jdbcType=DECIMAL}, 
      #{actionRate,jdbcType=DECIMAL}, #{yearRateStr,jdbcType=VARCHAR}, #{dayProfit,jdbcType=DECIMAL}, 
      #{raiseDayProfit,jdbcType=DECIMAL}, #{raiseDays,jdbcType=DECIMAL}, #{closeDays,jdbcType=DECIMAL}, 
      #{productType,jdbcType=VARCHAR}, #{subjectStatus,jdbcType=VARCHAR}, #{payType,jdbcType=VARCHAR}, 
      #{transferType,jdbcType=VARCHAR}, #{modifyDate,jdbcType=DATE}, #{raiseRateIncome,jdbcType=DECIMAL}, 
      #{couponAmount,jdbcType=DECIMAL}, #{integralAmount,jdbcType=DECIMAL}, #{cashAmount,jdbcType=DECIMAL}, 
      #{debtorNum,jdbcType=VARCHAR}, #{debtorName,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.zdmoney.models.order.ViewOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into LAOCAIBAO.VIEW_ORDER
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="orderNum != null" >
        ORDER_NUM,
      </if>
      <if test="customerId != null" >
        CUSTOMER_ID,
      </if>
      <if test="orderAmt != null" >
        ORDER_AMT,
      </if>
      <if test="productId != null" >
        PRODUCT_ID,
      </if>
      <if test="orderTime != null" >
        ORDER_TIME,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="yearRate != null" >
        YEAR_RATE,
      </if>
      <if test="interestStartDate != null" >
        INTEREST_START_DATE,
      </if>
      <if test="interestEndDate != null" >
        INTEREST_END_DATE,
      </if>
      <if test="principalinterest != null" >
        PRINCIPALINTEREST,
      </if>
      <if test="customerName != null" >
        CUSTOMER_NAME,
      </if>
      <if test="inviteCode != null" >
        INVITE_CODE,
      </if>
      <if test="confirmPaymentDate != null" >
        CONFIRM_PAYMENT_DATE,
      </if>
      <if test="paySerNum != null" >
        PAY_SER_NUM,
      </if>
      <if test="bankAccountId != null" >
        BANK_ACCOUNT_ID,
      </if>
      <if test="cmOpenMechanism != null" >
        CM_OPEN_MECHANISM,
      </if>
      <if test="cmOpenPlatform != null" >
        CM_OPEN_PLATFORM,
      </if>
      <if test="cmTogatherType != null" >
        CM_TOGATHER_TYPE,
      </if>
      <if test="cmOpenChannel != null" >
        CM_OPEN_CHANNEL,
      </if>
      <if test="cmRegisterVersion != null" >
        CM_REGISTER_VERSION,
      </if>
      <if test="isFirstOrder != null" >
        IS_FIRST_ORDER,
      </if>
      <if test="originalRate != null" >
        ORIGINAL_RATE,
      </if>
      <if test="invteRate != null" >
        INVTE_RATE,
      </if>
      <if test="actionRate != null" >
        ACTION_RATE,
      </if>
      <if test="yearRateStr != null" >
        YEAR_RATE_STR,
      </if>
      <if test="dayProfit != null" >
        DAY_PROFIT,
      </if>
      <if test="raiseDayProfit != null" >
        RAISE_DAY_PROFIT,
      </if>
      <if test="raiseDays != null" >
        RAISE_DAYS,
      </if>
      <if test="closeDays != null" >
        CLOSE_DAYS,
      </if>
      <if test="productType != null" >
        PRODUCT_TYPE,
      </if>
      <if test="subjectStatus != null" >
        SUBJECT_STATUS,
      </if>
      <if test="payType != null" >
        PAY_TYPE,
      </if>
      <if test="transferType != null" >
        TRANSFER_TYPE,
      </if>
      <if test="modifyDate != null" >
        MODIFY_DATE,
      </if>
      <if test="raiseRateIncome != null" >
        RAISE_RATE_INCOME,
      </if>
      <if test="couponAmount != null" >
        COUPON_AMOUNT,
      </if>
      <if test="integralAmount != null" >
        INTEGRAL_AMOUNT,
      </if>
      <if test="cashAmount != null" >
        CASH_AMOUNT,
      </if>
      <if test="debtorNum != null" >
        DEBTOR_NUM,
      </if>
      <if test="debtorName != null" >
        DEBTOR_NAME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=DECIMAL},
      </if>
      <if test="orderNum != null" >
        #{orderNum,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        #{customerId,jdbcType=DECIMAL},
      </if>
      <if test="orderAmt != null" >
        #{orderAmt,jdbcType=DECIMAL},
      </if>
      <if test="productId != null" >
        #{productId,jdbcType=DECIMAL},
      </if>
      <if test="orderTime != null" >
        #{orderTime,jdbcType=DATE},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="yearRate != null" >
        #{yearRate,jdbcType=DECIMAL},
      </if>
      <if test="interestStartDate != null" >
        #{interestStartDate,jdbcType=DATE},
      </if>
      <if test="interestEndDate != null" >
        #{interestEndDate,jdbcType=DATE},
      </if>
      <if test="principalinterest != null" >
        #{principalinterest,jdbcType=DECIMAL},
      </if>
      <if test="customerName != null" >
        #{customerName,jdbcType=VARCHAR},
      </if>
      <if test="inviteCode != null" >
        #{inviteCode,jdbcType=VARCHAR},
      </if>
      <if test="confirmPaymentDate != null" >
        #{confirmPaymentDate,jdbcType=DATE},
      </if>
      <if test="paySerNum != null" >
        #{paySerNum,jdbcType=VARCHAR},
      </if>
      <if test="bankAccountId != null" >
        #{bankAccountId,jdbcType=DECIMAL},
      </if>
      <if test="cmOpenMechanism != null" >
        #{cmOpenMechanism,jdbcType=VARCHAR},
      </if>
      <if test="cmOpenPlatform != null" >
        #{cmOpenPlatform,jdbcType=VARCHAR},
      </if>
      <if test="cmTogatherType != null" >
        #{cmTogatherType,jdbcType=VARCHAR},
      </if>
      <if test="cmOpenChannel != null" >
        #{cmOpenChannel,jdbcType=VARCHAR},
      </if>
      <if test="cmRegisterVersion != null" >
        #{cmRegisterVersion,jdbcType=VARCHAR},
      </if>
      <if test="isFirstOrder != null" >
        #{isFirstOrder,jdbcType=DECIMAL},
      </if>
      <if test="originalRate != null" >
        #{originalRate,jdbcType=DECIMAL},
      </if>
      <if test="invteRate != null" >
        #{invteRate,jdbcType=DECIMAL},
      </if>
      <if test="actionRate != null" >
        #{actionRate,jdbcType=DECIMAL},
      </if>
      <if test="yearRateStr != null" >
        #{yearRateStr,jdbcType=VARCHAR},
      </if>
      <if test="dayProfit != null" >
        #{dayProfit,jdbcType=DECIMAL},
      </if>
      <if test="raiseDayProfit != null" >
        #{raiseDayProfit,jdbcType=DECIMAL},
      </if>
      <if test="raiseDays != null" >
        #{raiseDays,jdbcType=DECIMAL},
      </if>
      <if test="closeDays != null" >
        #{closeDays,jdbcType=DECIMAL},
      </if>
      <if test="productType != null" >
        #{productType,jdbcType=VARCHAR},
      </if>
      <if test="subjectStatus != null" >
        #{subjectStatus,jdbcType=VARCHAR},
      </if>
      <if test="payType != null" >
        #{payType,jdbcType=VARCHAR},
      </if>
      <if test="transferType != null" >
        #{transferType,jdbcType=VARCHAR},
      </if>
      <if test="modifyDate != null" >
        #{modifyDate,jdbcType=DATE},
      </if>
      <if test="raiseRateIncome != null" >
        #{raiseRateIncome,jdbcType=DECIMAL},
      </if>
      <if test="couponAmount != null" >
        #{couponAmount,jdbcType=DECIMAL},
      </if>
      <if test="integralAmount != null" >
        #{integralAmount,jdbcType=DECIMAL},
      </if>
      <if test="cashAmount != null" >
        #{cashAmount,jdbcType=DECIMAL},
      </if>
      <if test="debtorNum != null" >
        #{debtorNum,jdbcType=VARCHAR},
      </if>
      <if test="debtorName != null" >
        #{debtorName,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <!--大拇指对接捞财宝视图-->
  <resultMap id="YmResultMap" type="com.zdmoney.webservice.api.dto.ym.vo.ViewOrderVo" >
    <result column="order_id" property="orderId" jdbcType="DECIMAL" />
    <result column="order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="customer_code" property="customerCode" jdbcType="VARCHAR" />
    <result column="ORDER_AMT" property="orderAmt" jdbcType="DECIMAL" />
    <result column="product_expiry" property="productExpiry" jdbcType="DECIMAL" />
    <result column="ORDER_TIME" property="orderTime"  jdbcType="TIMESTAMP"/>
    <result column="order_status" property="orderStatus" jdbcType="VARCHAR" />
    <result column="INTEREST_START" property="interestStart" jdbcType="TIMESTAMP"/>
    <result column="expire_date" property="expireDate" jdbcType="TIMESTAMP"/>
    <result column="INVITE_CODE" property="inviteCode" jdbcType="VARCHAR" />
    <result column="order_time" property="orderTime" jdbcType="TIMESTAMP"/>
    <result column="product_type" property="productType" jdbcType="VARCHAR" />
    <result column="first_order" property="firstOrder" jdbcType="DECIMAL" />
    <result column="product_name" property="productName" jdbcType="VARCHAR" />
    <result column="assign_flag" property="assignFlag" jdbcType="VARCHAR" />
    <result column="assign_date" property="assignDate"  jdbcType="TIMESTAMP"/>
    <result column="settle_date" property="settleDate"  jdbcType="TIMESTAMP"/>
    <result column="close_period" property="closePeriod" jdbcType="DECIMAL" />
    <result column="create_time" property="createTime"  jdbcType="TIMESTAMP"/>
    <result column="update_time" property="updateTime"  jdbcType="TIMESTAMP"/>
    <result column="init_order_no" property="initOrderNo" jdbcType="VARCHAR" />
    <result column="coupon_increase_revenue_amt" property="couponIncreaseRevenueAmt" jdbcType="DECIMAL" />
    <result column="coupon_amount" property="couponAmount" jdbcType="DECIMAL" />
    <result column="integral_amount" property="integralRmbAmount" jdbcType="DECIMAL" />
    <result column="transfer_type" property="transferType" jdbcType="VARCHAR" />
    <result column="exit_actual_date" property="exitDate" jdbcType="TIMESTAMP"/>
    <result column="re_invest_count" property="reInvestCount" jdbcType="DECIMAL" />
      <result column="re_create_time" property="reCreateTime" jdbcType="VARCHAR" />
      <result column="re_current_end_date" property="reCurrentEndDate" jdbcType="VARCHAR" />
      <result column="re_current_start_date" property="reCurrentStartDate" jdbcType="VARCHAR" />
      <result column="reinvest_days" property="reinvestDays" jdbcType="DECIMAL" />
      <result column="re_reinvest_amt" property="reReinvestAmt" jdbcType="DECIMAL" />
  </resultMap>

  <select id="getOrderInfo" resultMap="YmResultMap" parameterType="com.zdmoney.webservice.api.dto.ym.ViewOrderDto">
      select bo.id         order_id,
              bo.ORDER_NUM  order_no,
              cmi.CM_NUMBER customer_code,
              bo.ORDER_AMT,
              bo.CLOSE_DAYS product_expiry,

              bo.STATUS              order_status,
              bo.INTEREST_START_DATE interest_start,
              bo.INTEREST_END_DATE   expire_date,

              bo.INVITE_CODE,
              bo.order_time     order_time,
              bo.PRODUCT_TYPE,
              bo.IS_FIRST_ORDER first_order,

              bp.product_name,
              bp.TRANSFER_STATUS assign_flag,
              bdt.trade_date     assign_date,
              bpc.ahead_pay_date settle_date,

              bp.transfer_day    close_period,
              bo.ORDER_TIME      create_time,
              bo.MODIFY_DATE     update_time,
              bdtt.init_order_no,

              ((bo.RAISE_DAY_PROFIT - bo.DAY_PROFIT) * bo.RAISE_DAYS) coupon_increase_revenue_amt,
              bo.coupon_amount,
              bo.integral_amount,
              bo.transfer_type,
              bo.exit_actual_date,
              bo.re_invest_count,
              to_char(borl.create_time,'yyyy-MM-dd hh24:mi:ss') re_create_time,
              to_char(borl.current_end_date,'yyyy-MM-dd hh24:mi:ss') re_current_end_date,
              borl.reinvest_amt re_reinvest_amt,
              borl.reinvest_days,
              to_char(borl.source_end_date+1,'yyyy-MM-dd hh24:mi:ss') re_current_start_date

      from busi_order bo
        LEFT JOIN CUSTOMER_MAIN_INFO cmi
          on bo.CUSTOMER_ID = cmi.ID

      left join customer_main_info cmi2
          on cmi.cm_introduce_code = cmi2.cm_invite_code

        left join BUSI_PRODUCT bp
          on bo.PRODUCT_ID = bp.id

        left join busi_debt_transfer bdt
          on (bdt.init_order_no = bo.ORDER_NUM and bo.STATUS = '16' and
              bdt.transfer_status = '5')

        left join busi_product_contract bpc
          on (bpc.id = bp.CONTRACT_ID)

        left join busi_debt_transfer bdtt
          on (bdtt.new_order_no = bo.ORDER_NUM
              and bdtt.transfer_status = '5' and bdtt.is_settle = '1')

        left join BUSI_ORDER_REINVEST_LOG borl
          on borl.order_id = bo.id

      where bo.STATUS in ('0', '10', '14', '16', '9', '4','17','18','19')
    AND ( cmi.USER_LABEL='1' or cmi.user_level='4' or (cmi.user_level='3' and cmi2.user_level='4') )
    <if test="startTime != null" >
      AND bo.MODIFY_DATE >= to_date(#{startTime},'yyyy-mm-dd hh24:mi:ss')
    </if>
    <if test="endTime != null">
    <![CDATA[
            AND bo.MODIFY_DATE <= to_date(#{endTime},'yyyy-mm-dd hh24:mi:ss')
            ]]>
    </if>
  </select>
</mapper>